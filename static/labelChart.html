<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>ProgEdu Review avgLabel</title>
    <link rel="stylesheet" type="text/css" href="graph.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- 載入必要的 JavaScript library -->
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="labelChart.js"></script>

    <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <h1>ProgEdu Review Network</h1>

    <!-- 顯示 Reviewer 的平均 Label 圖表 -->
    <canvas id="reviewerChart" width="400" height="200" style="border: 1px solid black;"></canvas>

    <!-- 顯示 Reviewer 的相關資訊 -->
    <div id="dataDisplay"></div>

    <!-- 顯示審查網路 -->
    <div id="reviewNetwork" style="width: 1800px; height: 800px"></div>

    <script>
      console.log("Graph function script loaded"); // 在 script 開頭加入
      // 等待 DOM 加載完成後處理
      document.addEventListener('DOMContentLoaded', (event) => {
        fetch("../utils/processed_data/22selected_assignments_addscore.json")
          .then(response => response.json())
          .then(data => {
            console.log("Data loaded:", data);  // 查看讀取的資料

            // 確保 data 是一個陣列
            if (Array.isArray(data)) {
              let allReviewerAverages = [];
              data.forEach(assignment => {
                console.log(assignment);  // 檢查每個作業資料

                // 每個作業的 'Round' 應該是陣列
                if (Array.isArray(assignment.Round)) {
                  assignment.Round.forEach(round => {
                    // 處理每個 Round 物件
                    let reviewerAverages = calculateReviewerLabelAverages(round);
                    allReviewerAverages = allReviewerAverages.concat(reviewerAverages);
                  });
                } else {
                  console.error(`作業 ${assignment.Assignment} 的 'Round' 不是陣列`);
                }
              });

              // 呼叫圖表繪製函數
              drawGraph(allReviewerAverages);
            }
          })
          .catch(error => {
            console.error("讀取 JSON 失敗:", error);
          });
      });
    </script>
  </body>
</html>